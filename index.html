<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bluetooth Printer</title>
  <meta name="description" content="Print text and images to a Bluetooth Printer with a Web Bluetooth app.">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>
<body>
  <div class="container mt-4">
    <div class="card">
      <div class="card-body">
        <div class="progress" style="width: 100%;">
          <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;"></div>
        </div>
      </div>
    </div>

    <div class="card mt-4">
      <div class="card-body">
        <textarea id="message" class="form-control" rows="3" placeholder="Enter Message"></textarea>
      </div>
    </div>

    <div class="card mt-4">
      <div class="card-body">
        <input type="file" id="imageInput" accept="image/*" class="form-control">
      </div>
    </div>

    <div class="card mt-4">
      <div class="card-body text-center">
        <button id="printText" class="btn btn-primary">Print Text</button>
        <button id="printImage" class="btn btn-primary ml-2">Print Image</button>
      </div>
    </div>

    <div class="modal" tabindex="-1" role="dialog" id="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Error</h5>
          </div>
          <div class="modal-body">
            <p>Could not connect to Bluetooth device!</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS and dependencies -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      let progress = document.querySelector('.progress');
      let dialog = document.querySelector('#dialog');
      let message = document.querySelector('#message');
      let imageInput = document.querySelector('#imageInput');
      let printTextButton = document.querySelector('#printText');
      let printImageButton = document.querySelector('#printImage');
      let printCharacteristic;

      progress.hidden = true;

      function handleError(error) {
        console.log(error);
        progress.hidden = true;
        printCharacteristic = null;
        dialog.open();
      }

      function sendTextData() {
        // Get the bytes for the text
        let encoder = new TextEncoder("utf-8");
        // Add line feed + carriage return chars to text
        let text = encoder.encode(message.value + '\u000A\u000D');
        return printCharacteristic.writeValue(text).then(() => {
          console.log('Text Write done.');
        });
      }

      function sendImageData() {
        // Get the bytes for the text
        let base64String = "/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHCBUUFBcVFBQYGBcZGRcZGRoZGRkdFxkaGhkdGRgaFxcdICwjGiApIBkaJDYkKS0vMzMzGSI4PjgyPSwyMy8BCwsLDw4PHhISHTIqICIvMjIyMjIyMjIvMjIyMjIyMjIyMjIvMjIyMjIyMjIyMjIyMjIyLzIyMj0yMj0yPTI9Mv/AABEIAMIBAwMBIgACEQEDEQH/xAAcAAAABwEBAAAAAAAAAAAAAAAAAQIDBAUGBwj/xABNEAACAQIDBQUDBwcJBwQDAAABAgMAEQQSIQUTMUFRBgciYXEygZEUQlKhsdHwFSMzNXOzwSRicnSCkqKytBZEU4PC4fE0dYTDJTZj/8QAGgEAAgMBAQAAAAAAAAAAAAAAAAECAwQFBv/EACkRAAICAQQCAgIBBQEAAAAAAAABAgMRBBIhMRNBBSIyUTMjQmFxgRX/2gAMAwEAAhEDEQA/AOZA0Zkyg6m1tfxzpIoMtxY1qZA1mD7v8Y+FlxchWBEjMiIwzvIAubkbICLfdUXsT2VfajSqkyxboRtqhbMZM3Rha2Wtp2GxUkmxMcHkd8m+Vc7FiFEQsASdB5VE7hPbxn7PD/8A2VRuZIodvdgMRhViffxSxSyJHvEBupkbKDlJ8Q48DyqR2p7vGwOHeZsbG7IFIi3eV2BYL4buTzvw5VtNs/qnCf1rD/6g1Vd90uDG7WRJDiygMTg/m1TeeIP4uPHkaW5jMv2O7EvtGGSYYpYVjkKENHmFgisWLZhbRvqqThO72SU4sRYtHOGIAyx3EpMe8ABD2XpzrQd1rRjZO0DOCYg85kC+0Y/k67wLqNct7a1O7qcZhUjx0kCvHhhLGVEntqu7AJbU87nidKHJgYtewsh+Qfypf5be35s/m7R7zXxeLpyqZtTu4eCSCL5dGzzSrFlEdmQFHfOVz3I8FuXEV0PtJh1jxmyUQWVZpgo5Abk2Aqk7TyYX8t4NVSQYveRl3J/NmLdvZVGb2r5eXvo3MDN7T7rcTEkjpiopWjXOY8pVytiepsTY2vUTs33ey4vDpiZMSmHWU2iUoWZybhb+JbXsbWvoK63tMqWxqwDLiBh48zOCYypEu7AAN7iz/EcaoNmfq7Y1v+Nhf3clG5gcf21sqXCYh8LIA0iFQpX2XD2KFb9b+436Vrz3Wz5CBi4vlIjEhw+Q+zew/OXvxBF8triove+bbTLA5SsMLAjiCGYg/VWo2LtGXA7Ok2nj3aTEzIqQq9g2S7GJdOFyzOeg89KbkxYMl2b7ByYuAYiXEJhkeTdxhkLM7592AfEoF3uo4m44VHfsHjvlb4REVymQtKDaMJJfK5vr81tBc+E1vNiPm2Ps5iblsdhmY9WbHXY/EmonarFunaPBqkjKrpArqrEBxvJBZwNGGp40t7DBmYu7qd8c+CWdCI40keUoRYPwUJm1N/McKhdqeyDYGKLEJiExGHlbKsioVIJBZTa7AggHW/Kus7MhY7bxjhrKuGwwZbe0WzZTflbKfjWS7x8kmyMFJhrx4bPHaJgM1mVhGSwJ9nXTW+byoUnkMGX7K9hMXjwJFtDAQSsjjNm1tZEBv7zanezfYKTFQnESYpMPHnMSEoWLNn3Y0zKBdyFGp41o+5Kd99iYzI7IkcZVCzFFJZr5VOi+6rjscEi2UHxIMkbYpSiC10LYpVj1uLgSZWNDkwwco7V7Gl2fO0EjKzBFdHUWDIxIByngbgi3lWtfuulWSCP5Yn55XIO6PhyKG4Z9b3qF30xOu0CWbMrQIUFrZAGIK+eut/O3Ku0GSMSYVXUmUo+7YcFtGM99eYtyNNyYYOKbN7v55sTiod+iR4ZsskxTicubwpm6am5obQ7vp4cVhoN+rR4kkJMEOhCl7Ml+JAuNfsroezjptz9pJ/pxUzbPt7H/AGyf6aSluYYOe7Y7tMTDFLImKil3Kl2TKysFC5zzNjbWx4012W7t5cdhUxIxSxCQtZDEWIAYqDmzi97X4V03b7AxbTEAyzCEbxnuUYbk5cljcELccOPWj7JYeSLB7ORVuAg3ltAA0TEE9fEV+NG5hg5B2X7GS4tJpJJ0w0UDtHJIy5vEgu9lutgARqTzqL2u7NSbNlRJXWRJFZkZQR7J1DKeB1HOuh7GmfCz7UixGH3uAbESvJIMpEZkRZHDoTdkyunDUW58sr3qbBbDTQv8ommhlVxGssruYyLFgrMSSpBFNSeQwRcJ2Bxb4WXFyFYESIyIrLmeQBc2oB8AI9TrwqcO7pVghmm2nFCJkR1Dx29pQ2UEyC5ANXXYfESSbEx4kkd8omVc7M2VRELAXOg8qutj7Umd9mwT4CNIpEZVkd0kJCYYuMi5RkvkXrppScmGDi+KiEckkayLKqOyrIosrgcGA10pNXXbfCJDtLFxxqFQOpCgWUZ41c2A0Auxqlq+DzEiwUKFCpiG6FLbXxFgSTqNc3W50trSBUUBf7E7WyYXB4jBrCjrMZLuXIK51y6LbW1DsV2rk2Y0rJCku9WNTmYrlyZuFhrfNVDRVHxoeTYbf7wp8THFEuFiijjljlyoxs27bMqjQBReldpu8J8dBJC+BiVnUKJM2Z0AYN4SVvy+usaxpLP+BSdcUPJquyHbaTZ0MkK4ZJUkkLnO5HFFUqVsbiy/XS5e3UhjxkaYSJFxagEI1hHaPd3UAWPWsoDRijxxDLNjje8bESSYSR8OhbCsze2fzpZN2S2mnWpOO7x5J3ikOCgV4nWTNn8TZQwyZiL65uHlWFpUblTcW4EagHj5H7aPGgybc95s5knk+SR3mjjjI3h8IQPqNNb7w/CmOzfeDLhcPFh5cMk6xHNExazIRcrfTlc2PQ1kEtY3vewtbhx1v7qmbC2W2MxUWGWTdmUsM+XNbKpb2bi/DrRKuKQZC23teTF4lsVMqlmZDu9d2ES1o9eRA16kk861+P7zDOoWbZmFkC3yiQhwmlvCGQ291OSd1coxSYf5YCHhkkz7rhu3RMts3PeXvf5ppjCd2jyYyfCfLAN0kUmfde1vL6Zc2lrdah9R8kLsx26kwmHXDSYZJ4kk3kfiylHD7xbaWNn8Qqux3ameXaEe0JI0LxshSME5QqXsub1JN/OrH/YCU4J8YuJBySSIY93raOYxM2a/QZrWqWe7Zxjxgvlg1gE+fcjm7Jly5/5l7350voHIzhu8fEJjpcWMOlpI443izm1k9lla2h1PxqF2p7XNjIosMmHTD4eJgyorXJKghRfgFFzp6dKnv3eMMM+JbGAKkrxEGMAWSYxFy2bQaZqs27qgEEp2pGIzazmJchubDxby3GmtgcmX7IdqZNmySSJEsu8RFIZytspJ6a8aseznbx8NAcPNhknj3hkUZ7FWziRQb8bOAR6VJ7N93LYjDxTz4sQ7+whQJckkErmJ5kKTYchxpjZXd5PJisRhpZljTDBWeQKTnV7lCinh4Va/Qi2tDcGHJn+1m3ZdoTtPIqocgjRFJIVQb6nmSSdfStPJ3rTGSGT5JHeEOoGdvFnUL05WvVX2v7J/IEhnSdcRBP8AozlykXUOh6MCDe+npVAuznIDXW5F7G4+vlUXzxFFiUUsyZptl94c0OIxUrQI8eKbNJEW0By5dGtrcaEEUe1O8WeXE4aZYFSPDEtHCGPiJUpdm8lNhYdetY+WFk0YEfZ7jSarbkuy2NcJLKZt5u82Vjir4VB8qRUPjbwARmO40143p9u83FfyXLhwiQ8VWRwsoEZQK+moF81tdQK5+VpcMh9k8uH8acGm8MhZXtWUbqDvHlEmIaTBxvDicu8hL6XCBGa5GuZQoIP0RVT2v7Vy7SkjLxrGkQYIim+rWuWPoALDpVDQrQq0Z9xe7F7WSYXB4jCLCjrMZLuXIK51y+zbW1XOyO8iSGKBJcIk0mHXLDJnKlfAY7sLcchyk86xjyXC6AWFtBYnW926nzpNHjQbmP7Sx74maTES2zyNma3sjSyqPIAAe6mKFR5JbMBy51NfVCZIoUV6FPICBRijdCpIIsRRo1uQOh43+OlACKFKFrHX3dffypzDYV5PZGnU6L8edDkkuRiYkL+AZQx9km/iP0b8Bwq5fBKSJCPEqnNb5xy21qPDsjUFn1BB8I5jXiatYIWLBEsSb2BJuxAvlB+kdfhWSyz9FijkpMJshiBnbLpwGre8nQVYJs2IfMB9STUsUdV+RtdhghvsuI/NKnqpI+rhVTjcI0R11Q8G/gw5GtHeikQOpVhdSLEVKNjTBozFaHu7/WuE/pSfu2rPzwGNyh5ag9VPA+tSdjbSfC4iPERqrPGWIVr5TdSutvWtTe6PBD2eiWxqhZJT7ccpgB6CSVAB/jT4VV7J/XWP/YYT/rrlMnb/ABTCRd3FaTER4gi76NG0bBR5ExLTuG7xMVHi5sWIYS0qRoy3fKBHexHO5vVOxjydP7IPH8iySezLicZFY8Dnnl0Pra3vopP1+P8A29f38lcl/wBtcSMOsAjiGTEfKQ12zB98ZgOlsxt6UvFdvMW+OTHKkaOkIhKDMUdM7OQ19QbtxH0R50bJfoMo6Bt39SY79ti/9U9VW2v/ANVi/oQ/vhWY7VdvZ8ZAcOIY8PExzSZCWZzfNxsLAnU6XP2xp+02Ik2cmzmjjEahBnBbeWRw404cqi+OycYSl0jqOzz/ACLYv7aH/TTU1PjsTFtjFNFhxNDuMP8AKAHRXQDeFGUOwzaZ7r5/HD9n+3mJwkCYcwRzrEfzTMSGTja9gb2BIvobGomzO2WMhxUuLJSRpwBLGwyplX9GEtquUEgXvcE3uTeo7kT8M/0WneZsKJYcLi8NJIcNK6WiLMYkEiZkaNGP5sFQRl4DhpwrOVI7XdrZ8akcZijhhiYMkaXOqjKtzoLAcAAKio1wCOetX0NNmXUwlFLIsQCQhGIAYgXPAX51U7X2a+GkMUmtrEEcGB5irUVM26u+wiSnV4iYyeZA1X6tKstgmhaa1xeDI0hjaxpdqRINKwriR05cxJN6OlZAEU5gSb3XW62+ly18qKuhHo5zXIVChSJmsppsBV6gO12v51Iw7eH41ENUyYFnQoom0FHUsgIoUyz+MCnqknkYTC+nUgfHStTEgUBRwAsKyrHn01+FbDZ2GknTNGmcWFzcAA24XPPyrNqZqK5LIRz0INJuRqDYggg9COB91qN1IJVlKsujKdCD51N2Vstpy3jyKtgTa5JPIa2Bt1rJOyMYZfRbCDcsEzaOE3sSYlF9pc0qgc+bj0tr5VTXrfYbDLGixrwUWF9T7/WsztvY5jJkjUmM8QNSh8hxK/ZXP0+si5uL6L7aXjKKgGjBpA8taUK6eUzLhor9t4e6BxxT61PEfxqmBrVMoYEHgQQfQ1l5ICjtGb+HUE815EVqpn6K5IUZCVCk3AvYchfU2pF6TmqVNgpEUMwAB/w34Zul71pyQ3c4I9GiFjZQSfs8yeVP4bBs+reFf8R9PLzq0iiCiyiw/HE86zWalR4Rtp0jnzLor3wgQAsbsSB5DnoKVUnHLoD0Yfd/Go1ZHNz5ZvhWocIFCioVEsCdbi1N4GfId2/D5pPD0p6m5Yg2hqyuzY8lF9KsjgsBU2bMMFKcyhM9spHiZso4HprWfjkkj09teh9oeho8dj2eMJZgAb2PD3fAVsd0ZROQtLKE/wDBApPE2/Hn+POivfSlqQOGprPCDk8mqy2MY4HXewpKyU2daOtO457s5HA4prFHQURo2140buBqY3h2sDTJWpIWjtSFvBG+g0oUL0dAbyKzHPepBl6CkMlAUlLBJyHM+lx766/sFBHhMOoGm7juR1dcxPxJ+NcZeuy7HhcQYdG0yRxFtNSwVfDflauZ8pL+mjdo+W+Cl7TAb/TjkXN8Tb6rVednIwMNGbAFgWPmSxFz52ArO7bjkbEupWzOyrGOosFUjqL1r8NEI41QHRVA+A1Ncy+SVMYp8s01x+7bHgaaWcBrEFSdBcaE9AeF/KnMNC8i5swjU+z4czEcidQF9NabxkDKMshDI/hzAZSrcsw4a8iOdUR0dijvaJ+eDe0jYnZEMhu0YBPNfCT62qKezcJ4NIP7QNviKtkvYZuNhf15/XScQ+VGborHTyBqFd1imopjnCOM4OUrtkq7Ky5lDOAy6NYMQLjgdBTuJx0Ei+Mk24WBDD0PKs+zc+tz8TepuE2ez2LXVf8AEfuFepWEss5cYznLCQjCyNvAY1vlNwG5D+cRoPWrnchnMj2zG2muUW6X4+tLhhVBZRYfjiedLtVNl8nwjo06OMftLsFqMUVqOqDcJdAwIPpVbYjQ8Rx+8VaUzNAH8iOB+/qKkmQkiFR0JUKC7DTqOH30ycSnUVYk2VuyK7Y9ekuwGpNh51DkxZPsi3mePwqM5JOpv+PqqcamzJbrIx4iTHxg+aL+fKoryluJ06cqSVoVfGtI51mplMMCgBR0V6tM7bYdChQpZEJo70dJpgHejpIpVAAoUKFADy4Unl8dKX8gtqWt6C9WIpo6nyH1mrVWkR3MawGGVGVnFxmUnrluL++1dawmKjkUNG11IBBANrcvWuf9n9hyYlsz3WIE3I4vY2yqeZ6mujRxhVCqLKoAA5AAWFq878xbBtRXaO1ooSSy/YbKDYkA24aDT06U3iUzI6jiyke8inKNr8uPnw99cNSeUbnHgm4OYOisvC1iOhGhU9CPuqPtZxlVObOhA8lIZm9ABWL7V7XijJjkjzuQrERvIo0N1LmwvqPOh2f7VxySBJEZZH0Dsc2bopPzR9Vei8k5UcL0c9UYsyarEMfDYkXYAkcbWJ0v7qgdoNoiGJrMBIwIRSLluViOQ86PH7yYZIRlFwTK1wL/AP8ANRqx89BVY/ZqMEmXESM7cTpmPuNya5dUIRalJ/8ADa+eDFYXZ6rYt4m+oen31PqxxGwpVY7tHkTirZQp9CpPH7arR9lxrpqDqK6ysU+mWQhCKwhVC9NSSBeJ+/4VGfEseGnrxpqJPcTqFVWHxzE2IB09PjUeXGu5AvYHp99SUG2VW27I7i3lxaLxbXoNTUCbaDH2AF8zqfhwqJR1ojUkci7XzlxHgQ6ljdmLHz/h0pO686co6uXBhlZJvLY3u/Oi3fnTlCmRyxG786G686XQoyPIjd+dAR05S4oHf2VJ8SL5ZnNkB6XNJywEVKXQwUFDJVphdizSNYKB+cMRJ5MATqOmnGpcfZiVlQjQszq4PBLeyfMG32VU7612y1UWP0UG7obupOIwskds62zXI8wDlPpqKaFWxkpLKKZbovDEbrzobrzpVqUBUsi3Ma3dCnbUKMhuZOkew8+A9TwokFhb8edNgksAdCup8zwBFOmtPY+jedjJs2Gy/Qd19xOYfbV/esH2Nx+7mMbHwy2t0zi9viCR7hW9ryHylTjc2/Z6DSWKUECivTUkljlUZmPLgAOrHkKQ+GLgiR9CCCq+Eai2p4mufCCysmlnP+3eKjbEKUIchMrFbe1mOhPM2q97K9m1RVlnQNIdUQi4QciQeLfZVHsvYR+XCJxdY2Mh6Mq6pf1Nr++ujGutqrvFVGEWVwWXyIdXJtmyr5e0euvzR6a0QVI1LaKB7TE2/vMdTT1V2P2RHOuWXOw5eMgDpZRp8a5lbUpYk+CTWOil2t23ijOSG8j/AE7WjHmOb/ZWRG0VJJYnMSxYkakkkk6edMdpNlnDT7u+YWDIeZU8LjqOFRjs+XI0m7fILXYiwFzYcfMivQ1VVwitvshGQc8uYEr1PrblSVkIQ/AUmCNr3NxpSkiz6k9R8KuH7EQvYMfIAepptBc36affU38lybtpgLxB8hIOqkgEXXpqBeowFqsrSyc7Wah42iqKhQq45YKOhQoEFQoUdAAoqOioAl7KwqSyrG7FQ91DC1w1vDoeVdNw2BjjvlRfEVZjYasoADW5HS9cojlKMrjirKw/sm/8K68j3APUAj36iuT8nKcUsPg62gUWnnsSqAX0GpubAanrS6I0Rrh7mzo4Rju3cfiibqGHw1rJ1vu2WFLwZhxjYMb/AEfZNviKwNek+PnurOHrIYnkFKFJpQreYw6FChQBNnTS44j6/I03HKG1B++pYNQ3js/kbkevMX/hWzoa6FsOnHkRoQRwIPKtXsDtaMix4m4I03trg208YGoPnWWqOps5F7XIN/og6E/V9dZNXp67YfY26K1qe067BiI3GZHRgbaqQb/jWlSTIoJZlUDiSwAHmda52IURdQoA5m2vXXmaqHw+YkZQFJNj84gnTTl764VXxisnhPhHX1Nqpjls6JsSbeySSkxFgqpeIlgBmZlDNzbn7xV1euV4Zmj1jZkPVWIPv66da1uwe0hciOcjMdFk4AnkHHI+dPXfGWL7R5SMtGthN4ZqKp9sbYiw7DfSFVIzoqqSzkGxFxyBsat7Vz7tnKsuIC3usQy+RY6trztpWLQafyW7WuC/U3bIZKfGbSfE4sYl1yxqylQfoKwIH8TXUsdHHJG6yaxspv6WvcfVXLQtbDsztpGRcPKQGFghbg6ixVSeGYaaHjau1r9LKME4f2mLS6pSk1Iz2M7MYxbiOPOuuVgy5svLMpOhtVSmHeO6OtnUkEHiDxrr9cy27/6mb9o32Csmm1MrG4yXR04r2KXHrHgZI/nSzAAfzQkbE+XSqCjf22932UVdOEUkcPVycpgoUKOrTIFR0qKNnIVFLE8AOJq8w/Zw2vLIF8lsbeWY6U1HI0igoVc4zZSo6CPPJe/hNrkAXvy0099W2zdkF4947Sxg8MqAKB1Ite1KW2H5PBONbfRjxR1Y7dwxjkCsytcZgwt4lPC9udVua/AE0SwgjTOX4oJhXUOz2I3mGiY/QAPqun8K5ezj/tzrpPZrDNFEI2NzYPoNBnubBudc75FKVZ0NFGUJPKLcmm5mGU3OXTje1vSkT4e7ZhxtYg3KkcbEAg+8U2MOxJGWJVIFsqsXHHN43PP00riwrhjLZ0JTl0g4cSrqoILEgXAUm/1cK5ttVFWaVUFlDsAOmuo9xvXRNoYciNxGqjwmxva2nK3i+uuY11/jlF5cTma5tYTCWlikilCusc0OhQoUDLNaRKmZbfD15UoUZrWR9kZZBbXQjiOlIMZYmw0Itc+/lz4/VUrKKUBS25JRm4PKCCn5zFiOZ/gOVKoUKIQjHoJ2Tm8yYVGRQtQqbWVginh5RpV7U5cMBe8/sa8hYWkP44isofW/meJ8z9dJYfnP7I+00oVko0sK5OS9l9t0ppJ+gxTDzeLLl6Ek8NeGg1p+mpEzMMtrga9LHgP41fc8QY9LBSs5J+G25iIwFTEOByBUsB724VXyOSWYvnJJJY3ub9aZWdetvX76XGys6rm0N+HHQXtXI2Y5SO/BwXCYFgQklmNz04C3W/OkvAnzS/vApUzBHK3PAEddb86EBLkhdLC+v3CppyKbI1SeH2ROZHTSjosmUleYJv60dXx6OJasTaQuKUoQy6EcP/HOrNNtyEqGZEF7F0j8QHW2v1WqpoVNNoing2nZ2KKWRihaSw/OSOCL34KgOtjzJ10twq92/jzDCzLfMQFWwuAWIH8eHlWS7GbVSJ3jkIAkIKseAYaZSeVxzqf2sxJMipyVc3kS3A/AfXXMthZbqEn0dJWQjTldmUxTliV5cTfiedj9tNmhfVj/ADjRVpul9tv6OxoKYqpS9sQ6g8a23Zh3kjT88xKlgUuPAoAyi3HXrWKapeyceYJVktcC4I4XB41nsjvi0WW1p9I6JHIygOzMUIOa/wA1r6X6C16Yk7Q4VTYzJfyufrAqs2n2piaF92W3jAgKVtx0JNYXNbiCPx5Vlp0Sn+fBzbpWQ/FG92n2siCMsV5GIIBsQgv1J4+grDXokIPEm2vC1+FEK6lGnhUsRORfZKbzIWDShTd6UDWkzC6FFehSGWYo6IUK2CDoUVC9ACqAor0L0AKpDuFF/q50MOJJLmCCWYKbExxs6g8bFgLVFkfduRKrxyAXKyKyMB5KwvUXZH9k/FLvA4gOpPE/V0Apyk5ZAubcTZbXzbt8tuN75eFqSC5TOkMrJa+YRtlIHE5rWt50eSK9jdcv0HJIFFz+PIUjEPkjsdHfj5X4/AaUzhI5JWEgildBcgpG7KCOQIFMzz7xyw4cB18/r+ysts3N4XRsrxXBv2Jp3DfpE9T/AJTRYbDySsVhiklYcRGjOR65RpStzJFKiyxSRsSSBIjKSLEXAYCq5dFdO7emw8d+kPov8abw8mRg3LgfQ6GnsRFJJI27jkksFvkRmtxOuUaUzPh5EAMkUiKTa7xuoueVyLVGK+pZY5K3ch/aKWYNyYfWP+1RqmKkksQKRSvbgyRuykqbaMBaom5kz7vdS7y18m7fPbrlte3nThwsEdTDdLdETQp2bDSopZ4ZUUcWeN1UX0FyRYUa4OZlDCCYqQCGEblSCLgg21FtasM3jl+hgin0xDDiS3Aakmw5AE1HZrHKwKt0YFT8DT0OGlkGaOGR1uRmSN2W44i4FCeHkeyfQkuMx5X1168KNhTRb5pBzE5ctjmzXtbLxvflUjEbOmjXPJhp4k+k8Uir8SLCqrIbnk6+m18q4bWuhpRSgtMZwtiNQbWA4k+XWp+I2diVQu+ExCoBcs0UgUDqWI0FUuuXo6FeuqlHL7IbNrajc2FNxgEX0N+f8KQ4Itr4TpY/VryqfjfZj/8AQg5OODoD9m4IsNm3YeTKhLtc6m17DkNape1ezooTE0QyLIuq62B04X4c9K0ezpmaBN3ISCmULJZrG1sjNx40aYS9jKRIQoGoFl0tcDr51VXVarMt8GO6dc49HOs46j40YYdRW+xuBQEMIkK6KwyDQ9R1/AqFitlRuP0aga2stra8Ps16EVvawYvEjIUKtZdhMCbI/wDZGnuoqOQ8aCU0qoipbhp9nwpau3Ox+IrUijBIoVGbEm+XLr66c/upV2PMD0+809w9o67gcf8AzUPGOzAKBlViqk6XsSAdOVPoltefU6n403irZGzXtblxvyt53tUJ9MlDCkj0BtjFfk7Z+fDRKyxIgCi4UJcBnNuQBLE1j+93aOCxOAJjliklR0KZWUuAzAPa2trcfSrDsV2vlESQ7Rw8kJAVFndCIpL2VRIeCMdB0PlwNH3sdhYI4XxuGQRspG8RQAjBjbMq8FIOunGsZtN3jf1Q39SH7kVG7tIw2ysOrC4aNgRyILEEVJxn6oP9SH7kVE7ucQseyIHc2VY2Zj0AY3NAA7v9mnC4SaBh+jnxCjzXNdW96lT768+TGwkP85/8xr1ayAKxAtmBJ8zltc+4D4V5RxHB/wCk/wDmNBXPpf7PROz4V2bsovCqkxYYym+m8cR52ZiNdTSNtQptHZBkkjUM+G3yc93Ju86lTx0NvUVL7T/qnEf1OT9ya5jgm2/8iTdhPk24GX9FfdbvTz9mgsND3FIWwuJlb584X+5Gp/66t+9iETbKldNchSQHyVwD9tI7o8Pu9kRtY3dpnOmvtsg9dEFOjDvNsFkdWWQ4N7qwIbOqE6qdR4hQArufP/4mD+lN++epB2aPy2J7f7kdfPehbfCoHdR+pY//AJH7x60ZxgOE+WfO+S7y/kY95b40AUXfF+qZ/wClD++SrTs9iTHsrDSAXyYKFrdcsKm1VHe1+p5v+R+9Srbs9Ii7KwzOuZFwUJZbA5lEKkix0Nx1oAr9uJHtLY5meMKXw++S+pjcLmBVtOBFr6XFRe5X9Vp+1l/zVN2zh/l+yv5HIYI3gDIoRAN3k/QsouEFvD4Tp5jjC7lf1Un7SX/NQBVd1uyo2xe0MSygyJiXjRiL5QSS2XoTcC/StrsfbJxM+MgZFC4eRIwdTnDpmbMDp1FZvuo9raP9dk+yp/Y3/wBdtb9vF+6oAz3Y7s/DDtvGqqLliRXiXlHvCCco5fwvWvn7UJFjZMPiGjijWKN43dspkLEhwL6HLYcOtc723tPF4bb00mFheayRCSNQTmQqOJHA34GuhA4PasLRzQnMoBeKVcs0RYGzDmvOzKbGxoA4n24WAbQnOFZDE+RvBbIGYeK1tOIvVA63FW3anYPyDFyYbNmUBXRrAMUbhmtzFiKq6aMtnE8jmFx88YtHKyDoOF+vOpA2zih/vDfBfuqJRU8i8jJw25ih/vDf3V+6lfl7F/8AHP8AdW32VAoqeQ8kiy/2hxf/ABv8C0KrbUdG5h5GThQFEKBrWVIbQeJj6D8fGnhTUPC/W5+NKZwPfwHM0kSY5UbEvdTl1IsdOFwQePupYQn2v7o4e886dUWoaysAvq8nb5dztjZwjinC7xY7kWLIy5SVZb3B0qv71dsQwbOkgLgyyKI0S93NiMzEDgABxPXzrju5AbMuZWPEozKT62NEMOtySMxPEsSxPvNUeKRo80Tu+Mxcf5JIzpf5GBbMt77oaWvVP2YxCfkAKXW/yeUWLC/BuV64y2CjuAE8zqdB8edKGCjYkhBbgONj1I1qtx+20tbxDcz0B2M26mI2dBI0i590Ee7C+dBkYm/MkX99edJRcOOrPbz8R4VNOBj+gPr++nWw65coFhy8vSrPCyiVqfR2/YW0Itp7L3SSqrvhzBINC0bmPI10vci+o6i1Ndqdpw7N2WYGkDSDD7iNdMztu92GycgOJ8ga4Mi5WJBKsNCVJU/EUpEDOpa7EmxLEsbWOlzVLWC2E1KSR6C7MYqPDbLguyZo8MHK5h7QTOw48zen+yfaRMdg455d3G0mcNHnBACuyc9dQL++vO2LwiB7BdLA8T99MHDJ9H7aS5HOahLDO9d27JFstYndAyNiUN2UaiWQcL+VVqbWT/Zy+8Gf5KY7ZhmvbJa171xj5Mn0ftpUUCBhmUW58fdTfAoTUpYR3PvXxKNsiYK6k/mNAwJ/SpyBq37PvG+y8NE0qLmwcKHxLcXhUcCa87TYRQ58NgdQD058+tI+Sp9H7aFyE5qDwz0bNisLs/Z2QzKUhhyAllLMQuUWAOpJ5DrVH3N4lF2YgZ1U7yXQsAfa6E1w9YFBuAKI4dPo/bTwR8yOt92m34YsXjsPI6o0mId4yxAV7EhlB4X4Gt1gNnx4STF4p5lCTukhzWVUEaZT4r68Ca82bpbWsLfjnV9hdnwSRIJJpLlM1jJeNWzSqAVP7ND/AG6MArUzZdlu2EDbaxMjNlixAEUTtopKEZbnlm1tfyromH2QqY2XHb0FZYUiy6ZRkN82e+t9NPWuFnZWF8IMpYGMsbFQCbxgAX4G7OLH6HrSpdmYcLIvymTIqAqme9zeRTpe1hkTTo/lSwNWL2Su8rasWK2izwsGSNFjzDgzAktY8wOF6y9aT8gQJu88jIrCTml2ypEwy9Cd42h18NMx7KwxEf561ymYlltZhKdByIMaD/mUymeZPJQUKv12Xhy0aiX2nkzFnVcqJy4HxG+nXLS/yZhjlXecMwJEiDNaUrn8WlglmsOPuNMhgztHVwmzoTLEgkORlVpZMygAtmtYHhwHHrTv5OwwVmMpNjGQt14OqMQ3vLLccCtAbWUNqOpG1lRZ5FT2A7BbG4y30seelCgjtY6KRN7J9DQoVqBCxTSe039n/LQoUD9j44CjoUKkIFEKOhSYl2Fh+Mnqv2GkxeyvoKFCs0P5Wbr/AOCI4aFChWtmBEHEe2fRaKD20/pfwNChWKz2aqf5EOY79J/ZH2mmKFCoQ6DU/mwUT+zR0Kk+iFP5ol7S4p7/ALBUTlR0KjD8SzV/kFQoUKmZgUKFCgAjRmjoUDiOPKzBMzE2UWuSbel6boUKBvsKi/H1ihQoEHRGjoUAHQoUKBH/2Q==";
        // Add line feed + carriage return chars to text
        alert("ingresa el base 64")
        let imgUnit8 =  base64ToUint8Array(base64String);
        alert("fin conversion")
        return printCharacteristic.writeValue(imgUnit8).then(() => {
          console.log('Text Write done.');
        });
        alert("fin imprsion imagen")
  }


  function base64ToUint8Array(base64String) {
    const binaryString = window.atob(base64String);
    const length = binaryString.length;
    const uint8Array = new Uint8Array(length);

    for (let i = 0; i < length; i++) {
        uint8Array[i] = binaryString.charCodeAt(i);
    }

    return uint8Array;
}


      function sendPrinterData(callback) {
        callback(); // Either sendTextData or sendImageData
        progress.hidden = true;
      }

      printTextButton.addEventListener('click', function () {
        progress.hidden = false;
        if (printCharacteristic == null) {
          navigator.bluetooth.requestDevice({
            filters: [{
              services: ['000018f0-0000-1000-8000-00805f9b34fb']
            }]
          })
            .then(device => {
              console.log('> Found ' + device.name);
              console.log('Connecting to GATT Server...');
              return device.gatt.connect();
            })
            .then(server => server.getPrimaryService("000018f0-0000-1000-8000-00805f9b34fb"))
            .then(service => service.getCharacteristic("00002af1-0000-1000-8000-00805f9b34fb"))
            .then(characteristic => {
              // Cache the characteristic
              printCharacteristic = characteristic;
              sendPrinterData(sendTextData);
            })
            .catch(handleError);
        } else {
          sendPrinterData(sendTextData);
        }
      });

      printImageButton.addEventListener('click', function () {
        progress.hidden = false;
        if (printCharacteristic == null) {
          navigator.bluetooth.requestDevice({
            filters: [{
              services: ['000018f0-0000-1000-8000-00805f9b34fb']
            }]
          })
            .then(device => {
              console.log('> Found ' + device.name);
              console.log('Connecting to GATT Server...');
              return device.gatt.connect();
            })
            .then(server => server.getPrimaryService("000018f0-0000-1000-8000-00805f9b34fb"))
            .then(service => service.getCharacteristic("00002af1-0000-1000-8000-00805f9b34fb"))
            .then(characteristic => {
              // Cache the characteristic
              printCharacteristic = characteristic;
              sendPrinterData(sendImageData);
            })
            .catch(handleError);
        } else {
          sendPrinterData(sendImageData);
        }
      });
    });
  </script>
</body>
</html>
